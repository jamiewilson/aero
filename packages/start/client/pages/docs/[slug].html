<script on:build>
	import base from '@layouts/base'
	import { getCollection, render } from 'aero:content'

	export async function getStaticPaths() {
		const docs = await getCollection('docs')
		return docs.map(doc => ({ params: { slug: doc.id }, props: doc }))
	}

	// During build, Aero.props is the matched doc from getStaticPaths.
	// During dev, fall back to finding by slug.
	const doc = Aero.props?.id
		? Aero.props
		: (await getCollection('docs')).find(d => d.id === Aero.params.slug)
	const { html } = doc ? await render(doc) : { html: '' }
</script>

<base-layout title="{doc ? doc.data.title : 'Doc Not Found'}">
	<main>
		<article if="{ doc }" class="prose">
			<a href="/docs/">‚Üê All docs</a>
			<header>
				<h1>{doc.data.title}</h1>
				<p class="subtitle secondary">{doc.data.subtitle}</p>
				<hr />
			</header>
			<section>{html}</section>
		</article>

		<section else>
			<h1>Doc not found</h1>
			<p class="secondary">
				No document found for
				<code>{Aero.params.slug}</code>
			</p>
			<a href="/docs/">Back to docs</a>
		</section>
	</main>
</base-layout>
